<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultra-Hard Tic-Tac-Toe</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(59, 130, 246, 0.5); }
            50% { box-shadow: 0 0 40px rgba(59, 130, 246, 0.8); }
        }
        .pulse-glow {
            animation: pulse-glow 2s ease-in-out infinite;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }
        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }
        .cell-hover:hover {
            transform: scale(1.05);
            transition: transform 0.2s ease;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-900 via-blue-900 to-purple-900 min-h-screen flex items-center justify-center p-4">
    <div class="max-w-4xl w-full">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-5xl font-bold text-white mb-2">Ultra-Hard Tic-Tac-Toe</h1>
            <p class="text-blue-300 text-xl">Challenge the ultimate AI with 100 difficulty levels</p>
        </div>

        <!-- Game Stats -->
        <div class="grid grid-cols-3 gap-4 mb-6">
            <div class="bg-white/10 backdrop-blur-sm rounded-lg p-4 text-center">
                <p class="text-blue-300 text-sm">WINS</p>
                <p id="wins" class="text-3xl font-bold text-green-400">0</p>
            </div>
            <div class="bg-white/10 backdrop-blur-sm rounded-lg p-4 text-center">
                <p class="text-blue-300 text-sm">DRAWS</p>
                <p id="draws" class="text-3xl font-bold text-yellow-400">0</p>
            </div>
            <div class="bg-white/10 backdrop-blur-sm rounded-lg p-4 text-center">
                <p class="text-blue-300 text-sm">LOSSES</p>
                <p id="losses" class="text-3xl font-bold text-red-400">0</p>
            </div>
        </div>

        <!-- Difficulty Selector -->
        <div class="text-center mb-6">
            <label class="block text-white text-lg mb-2">Difficulty Level: <span id="difficultyDisplay" class="text-blue-400 font-bold">1</span>/100</label>
            <div class="flex items-center justify-center gap-4">
                <button onclick="decreaseDifficulty()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition">-</button>
                <input type="range" id="difficulty" min="1" max="100" value="1" 
                       class="w-64 h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer">
                <button onclick="increaseDifficulty()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition">+</button>
            </div>
            <div class="mt-2">
                <span class="text-sm text-gray-400">Level 1-33: Easy | 34-66: Medium | 67-100: Impossible</span>
            </div>
        </div>

        <!-- Game Board -->
        <div class="flex justify-center mb-6">
            <div id="board" class="grid grid-cols-3 gap-3 bg-white/20 p-6 rounded-2xl backdrop-blur-sm">
                <!-- Cells will be generated by JavaScript -->
            </div>
        </div>

        <!-- Game Info -->
        <div class="text-center">
            <p id="gameStatus" class="text-2xl font-bold text-white mb-4">Your turn (X)</p>
            <button onclick="resetGame()" class="bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white px-8 py-3 rounded-lg font-bold transition transform hover:scale-105">
                New Game
            </button>
        </div>

        <!-- Victory Animation -->
        <div id="victoryOverlay" class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden items-center justify-center">
            <div class="bg-white rounded-2xl p-8 text-center max-w-md mx-4">
                <h2 id="victoryMessage" class="text-3xl font-bold mb-4"></h2>
                <button onclick="resetGame()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg">
                    Play Again
                </button>
            </div>
        </div>
    </div>

    <script>
        let board = ['', '', '', '', '', '', '', '', ''];
        let currentPlayer = 'X';
        let gameActive = true;
        let difficulty = 1;
        let stats = { wins: 0, draws: 0, losses: 0 };

        const WINNING_COMBINATIONS = [
            [0, 1, 2], [3, 4, 5], [6, 7, 8],
            [0, 3, 6], [1, 4, 7], [2, 5, 8],
            [0, 4, 8], [2, 4, 6]
        ];

        function initGame() {
            const boardElement = document.getElementById('board');
            boardElement.innerHTML = '';
            
            for (let i = 0; i < 9; i++) {
                const cell = document.createElement('div');
                cell.className = 'w-24 h-24 bg-white/10 hover:bg-white/20 rounded-xl flex items-center justify-center cursor-pointer transition-all duration-200 cell-hover';
                cell.dataset.index = i;
                cell.addEventListener('click', () => handleCellClick(i));
                boardElement.appendChild(cell);
            }

            const slider = document.getElementById('difficulty');
            slider.addEventListener('input', (e) => {
                difficulty = parseInt(e.target.value);
                document.getElementById('difficultyDisplay').textContent = difficulty;
            });

            loadStats();
            updateDisplay();
        }

        function handleCellClick(index) {
            if (!gameActive || board[index] !== '') return;

            board[index] = currentPlayer;
            updateDisplay();

            if (checkWin(currentPlayer)) {
                stats.wins++;
                showVictory('You Win!', 'green');
                saveStats();
                return;
            }

            if (board.every(cell => cell !== '')) {
                stats.draws++;
                showVictory('Draw!', 'yellow');
                saveStats();
                return;
            }

            currentPlayer = 'O';
            gameActive = false;
            document.getElementById('gameStatus').textContent = 'AI thinking...';

            setTimeout(() => {
                makeAIMove();
            }, 500 + Math.random() * 1000);
        }

        function makeAIMove() {
            const move = getBestMove();
            board[move] = 'O';
            
            updateDisplay();
            
            if (checkWin('O')) {
                stats.losses++;
                showVictory('AI Wins!', 'red');
                saveStats();
                return;
            }

            if (board.every(cell => cell !== '')) {
                stats.draws++;
                showVictory('Draw!', 'yellow');
                saveStats();
                return;
            }

            currentPlayer = 'X';
            gameActive = true;
            document.getElementById('gameStatus').textContent = 'Your turn (X)';
        }

        function getBestMove() {
            // 100% perfect AI at level 100
            const perfect = difficulty === 100;
            const errorChance = Math.max(0, 1 - difficulty / 100);
            
            // Minimax with depth based on difficulty
            const bestMove = minimax(board, 'O', 3 + Math.floor(difficulty / 20)).index;
            
            // Introduce randomness based on difficulty
            if (Math.random() < errorChance) {
                const availableMoves = board.map((cell, index) => cell === '' ? index : null).filter(i => i !== null);
                return availableMoves[Math.floor(Math.random() * availableMoves.length)];
            }
            
            return bestMove;
        }

        function minimax(newBoard, player, depth) {
            const availSpots = newBoard.map((cell, index) => cell === '' ? index : null).filter(i => i !== null);

            if (checkWin('X')) return { score: -10 };
            if (checkWin('O')) return { score: 10 };
            if (availSpots.length === 0 || depth <= 0) return { score: 0 };

            const moves = [];

            for (let i = 0; i < availSpots.length; i++) {
                const move = {};
                move.index = availSpots[i];
                newBoard[availSpots[i]] = player;

                if (player === 'O') {
                    const result = minimax(newBoard, 'X', depth - 1);
                    move.score = result.score;
                } else {
                    const result = minimax(newBoard, 'O', depth - 1);
                    move.score = result.score;
                }

                newBoard[availSpots[i]] = '';
                moves.push(move);
            }

            let bestMove;
            if (player === 'O') {
                let bestScore = -10000;
                for (let i = 0; i < moves.length; i++) {
                    if (moves[i].score > bestScore) {
                        bestScore = moves[i].score;
                        bestMove = i;
                    }
                }
            } else {
                let bestScore = 10000;
                for (let i = 0; i < moves.length; i++) {
                    if (moves[i].score < bestScore) {
                        bestScore = moves[i].score;
                        bestMove = i;
                    }
                }
            }

            return moves[bestMove];
        }

        function checkWin(player) {
            return WINNING_COMBINATIONS.some(combination => 
                combination.every(index => board[index] === player)
            );
        }

        function updateDisplay() {
            const cells = document.querySelectorAll('#board > div');
            cells.forEach((cell, index) => {
                cell.textContent = board[index];
                cell.className = `w-24 h-24 bg-white/10 hover:bg-white/20 rounded-xl flex items-center justify-center cursor-pointer transition-all duration-200 cell-hover text-4xl font-bold ${board[index] === 'X' ? 'text-blue-400' : 'text-red-400'}`;
            });

            document.getElementById('wins').textContent = stats.wins;
            document.getElementById('draws').textContent = stats.draws;
            document.getElementById('losses').textContent = stats.losses;
        }

        function showVictory(message, color) {
            const overlay = document.getElementById('victoryOverlay');
            const messageElement = document.getElementById('victoryMessage');
            messageElement.textContent = message;
            messageElement.className = `text-3xl font-bold mb-4 text-${color}-600`;
            overlay.classList.remove('hidden');
            overlay.classList.add('flex');
        }

        function resetGame() {
            board = ['', '', '', '', '', '', '', '', ''];
            currentPlayer = 'X';
            gameActive = true;
            document.getElementById('gameStatus').textContent = 'Your turn (X)';
            document.getElementById('victoryOverlay').classList.add('hidden');
            updateDisplay();
        }

        function increaseDifficulty() {
            const slider = document.getElementById('difficulty');
            if (difficulty < 100) {
                difficulty++;
                slider.value = difficulty;
                document.getElementById('difficultyDisplay').textContent = difficulty;
            }
        }

        function decreaseDifficulty() {
            const slider = document.getElementById('difficulty');
            if (difficulty > 1) {
                difficulty--;
                slider.value = difficulty;
                document.getElementById('difficultyDisplay').textContent = difficulty;
            }
        }

        function saveStats() {
            localStorage.setItem('tictactoeStats', JSON.stringify(stats));
        }

        function loadStats() {
            const saved = localStorage.getItem('tictactoeStats');
            if (saved) {
                stats = JSON.parse(saved);
            }
        }

        // Initialize game
        initGame();
    </script>
</body>
</html>
